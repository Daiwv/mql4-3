//+------------------------------------------------------------------+
//|                                            NormalProbability.mq4 |
//|                      Copyright © 2007, MetaQuotes Software Corp. |
//|                                        http://www.metaquotes.ru/ |
//+------------------------------------------------------------------+
#property copyright "Copyright © 2007, MetaQuotes Software Corp."
#property link      "http://www.metaquotes.ru/"

double NormalP[302];

//+------------------------------------------------------------------+
//| заполнение масства для вычисления вероятности P нормальн. распред|
//+------------------------------------------------------------------+
//
void NormalPInitialize()
   {
   NormalP[301]=0.998693692330731;
   NormalP[300]=0.998650032776765;
   NormalP[299]=0.998605043637129;
   NormalP[298]=0.998558689055601;
   NormalP[297]=0.99851093236486;
   NormalP[296]=0.998461736073078;
   NormalP[295]=0.99841106185044;
   NormalP[294]=0.998358870515592;
   NormalP[293]=0.998305122022035;
   NormalP[292]=0.998249775444459;
   NormalP[291]=0.998192788965025;
   NormalP[290]=0.998134119859606;
   NormalP[289]=0.998073724483981;
   NormalP[288]=0.998011558260005;
   NormalP[287]=0.997947575661737;
   NormalP[286]=0.997881730201563;
   NormalP[285]=0.997813974416288;
   NormalP[284]=0.997744259853227;
   NormalP[283]=0.997672537056298;
   NormalP[282]=0.997598755552106;
   NormalP[281]=0.997522863836057;
   NormalP[280]=0.997444809358475;
   NormalP[279]=0.997364538510758;
   NormalP[278]=0.997281996611563;
   NormalP[277]=0.997197127893035;
   NormalP[276]=0.997109875487089;
   NormalP[275]=0.99702018141175;
   NormalP[274]=0.996927986557559;
   NormalP[273]=0.996833230674061;
   NormalP[272]=0.996735852356376;
   NormalP[271]=0.996635789031861;
   NormalP[270]=0.996532976946889;
   NormalP[269]=0.996427351153725;
   NormalP[268]=0.996318845497542;
   NormalP[267]=0.99620739260356;
   NormalP[266]=0.996092923864335;
   NormalP[265]=0.995975369427197;
   NormalP[264]=0.995854658181862;
   NormalP[263]=0.995730717748209;
   NormalP[262]=0.995603474464252;
   NormalP[261]=0.995472853374304;
   NormalP[260]=0.995338778217355;
   NormalP[259]=0.995201171415667;
   NormalP[258]=0.995059954063601;
   NormalP[257]=0.994915045916694;
   NormalP[256]=0.99476636538098;
   NormalP[255]=0.994613829502589;
   NormalP[254]=0.994457353957626;
   NormalP[253]=0.994296853042336;
   NormalP[252]=0.994132239663578;
   NormalP[251]=0.993963425329619;
   NormalP[250]=0.993790320141255;
   NormalP[249]=0.993612832783276;
   NormalP[248]=0.993430870516292;
   NormalP[247]=0.993244339168922;
   NormalP[246]=0.993053143130374;
   NormalP[245]=0.99285718534341;
   NormalP[244]=0.99265636729774;
   NormalP[243]=0.992450589023816;
   NormalP[242]=0.992239749087084;
   NormalP[241]=0.992023744582676;
   NormalP[240]=0.991802471130569;
   NormalP[239]=0.991575822871222;
   NormalP[238]=0.99134369246171;
   NormalP[237]=0.99110597107236;
   NormalP[236]=0.990862548383906;
   NormalP[235]=0.990613312585189;
   NormalP[234]=0.990358150371388;
   NormalP[233]=0.990096946942834;
   NormalP[232]=0.989829586004383;
   NormalP[231]=0.989555949765389;
   NormalP[230]=0.989275918940281;
   NormalP[229]=0.988989372749757;
   NormalP[228]=0.988696188922606;
   NormalP[227]=0.988396243698187;
   NormalP[226]=0.988089411829557;
   NormalP[225]=0.987775566587278;
   NormalP[224]=0.987454579763911;
   NormalP[223]=0.987126321679209;
   NormalP[222]=0.986790661186026;
   NormalP[221]=0.98644746567695;
   NormalP[220]=0.986096601091681;
   NormalP[219]=0.985737931925155;
   NormalP[218]=0.985371321236445;
   NormalP[217]=0.984996630658428;
   NormalP[216]=0.984613720408251;
   NormalP[215]=0.9842224492986;
   NormalP[214]=0.983822674749778;
   NormalP[213]=0.983414252802617;
   NormalP[212]=0.982997038132223;
   NormalP[211]=0.982570884062573;
   NormalP[210]=0.982135642581971;
   NormalP[209]=0.981691164359378;
   NormalP[208]=0.98123729876162;
   NormalP[207]=0.980773893871488;
   NormalP[206]=0.98030079650674;
   NormalP[205]=0.979817852240016;
   NormalP[204]=0.979324905419665;
   NormalP[203]=0.978821799191513;
   NormalP[202]=0.97830837552155;
   NormalP[201]=0.977784475219582;
   NormalP[200]=0.977249937963814;
   NormalP[199]=0.97670460232641;
   NormalP[198]=0.976148305800005;
   NormalP[197]=0.975580884825197;
   NormalP[196]=0.975002174819012;
   NormalP[195]=0.974412010204354;
   NormalP[194]=0.973810224440442;
   NormalP[193]=0.973196650054235;
   NormalP[192]=0.972571118672856;
   NormalP[191]=0.971933461057015;
   NormalP[190]=0.971283507135429;
   NormalP[189]=0.970621086040249;
   NormalP[188]=0.969946026143487;
   NormalP[187]=0.969258155094455;
   NormalP[186]=0.968557299858203;
   NormalP[185]=0.967843286754964;
   NormalP[184]=0.96711594150061;
   NormalP[183]=0.966375089248104;
   NormalP[182]=0.965620554629951;
   NormalP[181]=0.964852161801659;
   NormalP[180]=0.964069734486179;
   NormalP[179]=0.963273096019349;
   NormalP[178]=0.962462069396318;
   NormalP[177]=0.961636477318946;
   NormalP[176]=0.96079614224419;
   NormalP[175]=0.959940886433443;
   NormalP[174]=0.959070532002845;
   NormalP[173]=0.958184900974537;
   NormalP[172]=0.957283815328864;
   NormalP[171]=0.956367097057503;
   NormalP[170]=0.955434568217523;
   NormalP[169]=0.954486050986343;
   NormalP[168]=0.953521367717606;
   NormalP[167]=0.95254034099792;
   NormalP[166]=0.95154279370449;
   NormalP[165]=0.950528549063593;
   NormalP[164]=0.949497430709909;
   NormalP[163]=0.948449262746673;
   NormalP[162]=0.947383869806639;
   NormalP[161]=0.946301077113841;
   NormalP[160]=0.945200710546126;
   NormalP[159]=0.944082596698449;
   NormalP[158]=0.942946562946898;
   NormalP[157]=0.941792437513449;
   NormalP[156]=0.940620049531403;
   NormalP[155]=0.939429229111508;
   NormalP[154]=0.938219807408727;
   NormalP[153]=0.936991616689635;
   NormalP[152]=0.935744490400425;
   NormalP[151]=0.934478263235489;
   NormalP[150]=0.933192771206552;
   NormalP[149]=0.931887851712338;
   NormalP[148]=0.930563343608734;
   NormalP[147]=0.929219087279425;
   NormalP[146]=0.927854924706979;
   NormalP[145]=0.92647069954434;
   NormalP[144]=0.925066257186716;
   NormalP[143]=0.92364144484381;
   NormalP[142]=0.922196111612385;
   NormalP[141]=0.920730108549116;
   NormalP[140]=0.919243288743703;
   NormalP[139]=0.917735507392213;
   NormalP[138]=0.916206621870606;
   NormalP[137]=0.914656491808433;
   NormalP[136]=0.913084979162646;
   NormalP[135]=0.911491948291503;
   NormalP[134]=0.909877266028523;
   NormalP[133]=0.908240801756458;
   NormalP[132]=0.906582427481241;
   NormalP[131]=0.904902017905884;
   NormalP[130]=0.903199450504266;
   NormalP[129]=0.9014746055948;
   NormalP[128]=0.899727366413917;
   NormalP[127]=0.897957619189342;
   NormalP[126]=0.896165253213115;
   NormalP[125]=0.894350160914323;
   NormalP[124]=0.892512237931494;
   NormalP[123]=0.890651383184624;
   NormalP[122]=0.888767498946784;
   NormalP[121]=0.886860490915277;
   NormalP[120]=0.884930268282296;
   NormalP[119]=0.882976743805042;
   NormalP[118]=0.880999833875261;
   NormalP[117]=0.878999458588169;
   NormalP[116]=0.876975541810699;
   NormalP[115]=0.87492801124905;
   NormalP[114]=0.872856798515485;
   NormalP[113]=0.870761839194342;
   NormalP[112]=0.868643072907204;
   NormalP[111]=0.8665004433772;
   NormalP[110]=0.864333898492388;
   NormalP[109]=0.862143390368174;
   NormalP[108]=0.859928875408732;
   NormalP[107]=0.857690314367382;
   NormalP[106]=0.855427672405876;
   NormalP[105]=0.853140919152565;
   NormalP[104]=0.850830028759386;
   NormalP[103]=0.848494979957654;
   NormalP[102]=0.84613575611259;
   NormalP[101]=0.843752345276565;
   NormalP[100]=0.841344740241009;
   NormalP[99]=0.838912938586955;
   NormalP[98]=0.836456942734165;
   NormalP[97]=0.833976759988811;
   NormalP[96]=0.831472402589668;
   NormalP[95]=0.828943887752782;
   NormalP[94]=0.826391237714571;
   NormalP[93]=0.823814479773333;
   NormalP[92]=0.821213646329111;
   NormalP[91]=0.818588774921891;
   NormalP[90]=0.815939908268093;
   NormalP[89]=0.813267094295319;
   NormalP[88]=0.810570386175331;
   NormalP[87]=0.807849842355217;
   NormalP[86]=0.805105526586722;
   NormalP[85]=0.802337507953709;
   NormalP[84]=0.799545860897718;
   NormalP[83]=0.796730665241597;
   NormalP[82]=0.793892006211172;
   NormalP[81]=0.791029974454938;
   NormalP[80]=0.78814466606173;
   NormalP[79]=0.785236182576359;
   NormalP[78]=0.782304631013188;
   NormalP[77]=0.779350123867618;
   NormalP[76]=0.776372779125466;
   NormalP[75]=0.773372720270214;
   NormalP[74]=0.770350076288108;
   NormalP[73]=0.76730498167108;
   NormalP[72]=0.764237576417494;
   NormalP[71]=0.761148006030676;
   NormalP[70]=0.758036421515226;
   NormalP[69]=0.754902979371099;
   NormalP[68]=0.75174784158543;
   NormalP[67]=0.748571175622103;
   NormalP[66]=0.745373154409045;
   NormalP[65]=0.742153956323241;
   NormalP[64]=0.738913765173454;
   NormalP[63]=0.735652770180657;
   NormalP[62]=0.73237116595615;
   NormalP[61]=0.729069152477383;
   NormalP[60]=0.725746935061454;
   NormalP[59]=0.722404724336311;
   NormalP[58]=0.719042736209625;
   NormalP[57]=0.715661191835367;
   NormalP[56]=0.712260317578065;
   NormalP[55]=0.708840344974756;
   NormalP[54]=0.705401510694645;
   NormalP[53]=0.701944056496463;
   NormalP[52]=0.69846822918354;
   NormalP[51]=0.694974280556601;
   NormalP[50]=0.691462467364298;
   NormalP[49]=0.687933051251484;
   NormalP[48]=0.684386298705246;
   NormalP[47]=0.680822480998713;
   NormalP[46]=0.677241874132651;
   NormalP[45]=0.673644758774869;
   NormalP[44]=0.670031420197443;
   NormalP[43]=0.666402148211795;
   NormalP[42]=0.662757237101629;
   NormalP[41]=0.659096985553765;
   NormalP[40]=0.655421696586884;
   NormalP[39]=0.651731677478207;
   NormalP[38]=0.648027239688151;
   NormalP[37]=0.644308698782966;
   NormalP[36]=0.640576374355405;
   NormalP[35]=0.636830589943443;
   NormalP[34]=0.633071672947078;
   NormalP[33]=0.629299954543257;
   NormalP[32]=0.625515769598949;
   NormalP[31]=0.621719456582403;
   NormalP[30]=0.617911357472638;
   NormalP[29]=0.61409181766718;
   NormalP[28]=0.610261185888116;
   NormalP[27]=0.606419814086467;
   NormalP[26]=0.602568057344958;
   NormalP[25]=0.598706273779198;
   NormalP[24]=0.59483482443733;
   NormalP[23]=0.590954073198183;
   NormalP[22]=0.58706438666798;
   NormalP[21]=0.583166134075642;
   NormalP[20]=0.579259687166734;
   NormalP[19]=0.575345420096107;
   NormalP[18]=0.571423709319267;
   NormalP[17]=0.567494933482544;
   NormalP[16]=0.563559473312093;
   NormalP[15]=0.559617711501774;
   NormalP[14]=0.555670032599981;
   NormalP[13]=0.551716822895456;
   NormalP[12]=0.547758470302135;
   NormalP[11]=0.543795364243102;
   NormalP[10]=0.539827895533675;
   NormalP[9]=0.535856456263704;
   NormalP[8]=0.53188143967911;
   NormalP[7]=0.527903240062745;
   NormalP[6]=0.523922252614601;
   NormalP[5]=0.519938873331451;
   NormalP[4]=0.515953498885948;
   NormalP[3]=0.511966526505264;
   NormalP[2]=0.507978353849306;
   NormalP[1]=0.503989378888578;
   NormalP[0]=0.499999999781729;

   return;   
   }

//+------------------------------------------------------------------+
//| вычисления однохвостовой вероятности P нормальн. распределения   |
//+------------------------------------------------------------------+
//
double GetNormalP(double Distr)
   {
   double res;
   int index=MathAbs(NormalizeDouble(Distr,2)*100);
   if (index>301) index=301;
   res=NormalP[index];
   //if (Distr<0) res=1.0-res;
   return(res);
   }

//+------------------------------------------------------------------+
//| вычисления вероятности P нормальн. распределения                 |
//+------------------------------------------------------------------+
//
double GetNormalP_2_Tailes(double InpDistr)
   {
   double res;
   
   res=GetNormalP(InpDistr)-(1-GetNormalP(InpDistr));
   return(res);
   }
   
//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
double fConfidence_limit(double Z_score)
   {
   double n_Z=0.398942*MathExp(-(MathPow(Z_score,2)/2.0));
   double Y=1.0/(1+0.2316419*MathAbs(Z_score));
   double N_Z=1-n_Z*((1.330274429*MathPow(Y,5))-(1.821255978*MathPow(Y,4))+(1.781477937*MathPow(Y,3))-(0.356563782*MathPow(Y,2))+(0.31938153*Y));
   if( Z_score<0 ) N_Z=1-N_Z;
   //---
   return((1-((1-N_Z) * 2.0)));
   }   

//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
double ProbFunction(double Value)
   {
   double res;
//----
   double n_Z=0.398942*MathExp(-(MathPow(Value,2)/2.0));
   double Y=1.0/(1+0.2316419*MathAbs(Value));
   double N_Z=1-n_Z*((1.330274429*MathPow(Y,5))-(1.821255978*MathPow(Y,4))+(1.781477937*MathPow(Y,3))-(0.356563782*MathPow(Y,2))+(0.31938153*Y));
   if( Value<0 ) N_Z=1-N_Z;
   res=N_Z;
//----
   return(res);   
   }

//+------------------------------------------------------------------+

